(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{31:function(e,t,i){},32:function(e,t,i){},55:function(e,t){},56:function(e,t){},57:function(e,t){},58:function(e,t){},59:function(e,t){},62:function(e,t,i){"use strict";i.r(t);var a=i(2),n=i(1),s=i.n(n),c=i(24),r=i.n(c),d=(i(31),i(7)),o=i(8),h=i(10),l=i(9),u=(i(32),function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e){var a;return Object(d.a)(this,i),(a=t.call(this,e)).ref=Object(n.createRef)(),a.width=0,a.height=0,a.cx=a.props.layout.cx,a.cy=a.props.layout.cy,a}return Object(o.a)(i,[{key:"componentDidMount",value:function(){var e=this.ref.current,t=0;for(var i in this.props.cards){var a=this.props.cards[i];this.drawImage(e,a.img,t++)}}},{key:"drawImage",value:function(e,t,i){var a=e.getContext("2d");this.width&&this.height||(e.width=this.width=t.width*this.cx,e.height=this.height=t.height*this.cy);var n=i%this.cx,s=Math.floor(i/this.cx);a.drawImage(t,n*t.width,s*t.height,t.width,t.height)}},{key:"render",value:function(){return Object(a.jsx)("canvas",{ref:this.ref,width:this.width,height:this.height})}}]),i}(s.a.Component)),j=i(11),m=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(){var e;return Object(d.a)(this,i),(e=t.call(this)).layouts={tts:{cx:10,cy:7},pnp_common:{cx:3,cy:3}},e.state={loading:!1,imposable:!1,cards:[],cardsCount:0,layout:"tts"},e.waiting=[],e}return Object(o.a)(i,[{key:"componentDidMount",value:function(){j.a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(j.a.version,"/pdf.worker.js")}},{key:"load",value:function(e){for(var t=e.target,i=t.files.length;i>0;){var a=t.files[i-1],n=new FileReader;switch(a.type){case"image/jpeg":case"image/png":n.onload=this.loadedImage.bind(this,a.name,i),n.readAsDataURL(a);break;case"application/pdf":n.onload=this.loadedPDF.bind(this,a.name,i),n.readAsArrayBuffer(a);break;default:alert("no loader for "+a.type)}i--}t.value=""}},{key:"loadedImage",value:function(e,t,i){var a=this.addWaiting(),n=new Image;n.title=e,n.onload=function(e,t){this.removeWaiting(e),this.addCard(t.target,t.target.title)}.bind(this,a),n.src=i.target.result}},{key:"addCard",value:function(e,t){var i=this.state.cards,a={uuid:this.UUID(),img:e,name:t,count:1};return i.push(a),this.setState({cards:i}),a}},{key:"loadedPDF",value:function(e,t,i){var a=new Uint8Array(i.target.result);j.a.getDocument(a).promise.then(function(t){var i=t.numPages;do{var a=this.addWaiting();t.getPage(i).then(function(t,i){var a=i.getViewport({scale:4.166666}),n=document.createElement("canvas");document.body.appendChild(n),n.setAttribute("style","display: none;");var s=n.getContext("2d");n.width=a.width,n.height=a.height,i.render({canvasContext:s,viewport:a}).promise.then(function(a){this.removeWaiting(t);var n=document.createElement("img");n.setAttribute("src",a.toDataURL("image/jpeg")),n.setAttribute("width",a.width),n.setAttribute("height",a.height),document.body.removeChild(a),this.addCard(n,e+" page "+i.pageNumber)}.bind(this,n,t),function(e,t){this.removeWaiting(e),console.log("page.render.reject",t)}.bind(t))}.bind(this,a))}while(i-- >1)}.bind(this))}},{key:"updateLayout",value:function(e){e.persist(),this.setState({layout:e.target.value})}},{key:"updateCount",value:function(e){e.persist();var t=e.target;this.updateCard(t.name,"count",t.value)}},{key:"updateCard",value:function(e,t,i){var a=this.state.cards;for(var n in a)a[n].uuid==e&&(a[n][t]=i);this.setState({cards:a,cardsCount:a.length})}},{key:"render",value:function(){return Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("div",{className:"container-fluid",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsxs)("div",{className:"col-3",id:"sidebar",children:[Object(a.jsx)("h1",{children:"Deck-Imposer"}),Object(a.jsxs)("div",{className:"step mb-5",children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 1."})," Select Images or PDF"]}),Object(a.jsx)("div",{className:"form-group",children:Object(a.jsx)("input",{type:"file",name:"img[]",id:"upload",multiple:!0,onChange:this.load.bind(this),accept:"image/*,application/pdf"})}),1==this.state.loading&&Object(a.jsx)("p",{children:"Loading..."})]}),Object(a.jsxs)("div",{className:"step mb-5",children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 2."})," Select Layout"]}),Object(a.jsx)("div",{className:"form-group",children:Object(a.jsxs)("select",{className:"form-control",onChange:this.updateLayout.bind(this),children:[Object(a.jsx)("option",{value:"tts",children:"Tabletop Simulator Deck (10x7)"}),Object(a.jsx)("option",{value:"pnp_common",children:"Common PnP (3x3)"})]})})]}),Object(a.jsxs)("div",{className:"step mb-5",children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 3."})," Set quantity of each card."]}),Object(a.jsx)("div",{id:"cards",children:this.renderCards()})]}),Object(a.jsx)("div",{className:"step mb-5",children:Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 4."})," Right click and save imposed image(s)."]})})]}),Object(a.jsxs)("div",{className:"col-9",id:"main",children:[Object(a.jsx)("div",{id:"top"}),Object(a.jsx)("div",{id:"canvas_container",children:this.renderPages()})]})]})}),Object(a.jsx)("footer",{className:"container my-5",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsxs)("div",{className:"col-md-4",children:["For info or help, visit ",Object(a.jsx)("a",{href:"https://github.com/BrianWendt/deck-imposer",children:"GitHub"})]}),Object(a.jsx)("div",{className:"col-md-4 text-center",children:"GNU General Public License v3.0"}),Object(a.jsx)("div",{className:"col-md-4 text-right",children:"Pay it forward."})]})})]})}},{key:"renderCards",value:function(){var e=this,t=this.state.cards.map((function(t){return Object(a.jsx)("div",{className:"form-group",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsx)("div",{className:"col-sm-9",children:Object(a.jsx)("label",{children:t.name})}),Object(a.jsx)("div",{className:"col-sm-3",children:Object(a.jsx)("input",{name:t.uuid,value:t.count,onChange:e.updateCount.bind(e),type:"number",min:"0",step:"1",className:"form-control"})})]})},t.uuid)}));return Object(a.jsx)("div",{children:t})}},{key:"renderPages",value:function(){var e=[];if(this.state.loading)return Object(a.jsx)("div",{});var t=this.layouts[this.state.layout],i=[],n=0;for(var s in this.state.cards)for(var c=this.state.cards[s],r=c.count;r>0;)i.push(c),r--,++n==t.cx*t.cy&&(n=0,e.push(Object(a.jsx)(u,{cards:i,layout:t},Math.random())),i=[]);return e.push(Object(a.jsx)(u,{cards:i,layout:t},Math.random())),Object(a.jsx)("div",{children:e})}},{key:"UUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}))}},{key:"addWaiting",value:function(){this.setState({loading:!0});var e=this.UUID();return this.waiting.push(e),e}},{key:"removeWaiting",value:function(e){var t=this.waiting.indexOf(e);t>-1&&this.waiting.splice(t,1),this.waiting.length<1&&this.setState({loading:!1})}}]),i}(s.a.Component),p=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,63)).then((function(t){var i=t.getCLS,a=t.getFID,n=t.getFCP,s=t.getLCP,c=t.getTTFB;i(e),a(e),n(e),s(e),c(e)}))};r.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(m,{})}),document.getElementById("root")),p()}},[[62,1,2]]]);
//# sourceMappingURL=main.23308b40.chunk.js.map