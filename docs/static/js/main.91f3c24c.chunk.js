(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{31:function(e,t,i){},32:function(e,t,i){},55:function(e,t){},56:function(e,t){},57:function(e,t){},58:function(e,t){},59:function(e,t){},62:function(e,t,i){"use strict";i.r(t);var a=i(2),n=i(1),s=i.n(n),c=i(24),r=i.n(c),d=(i(31),i(7)),o=i(8),l=i(10),h=i(9),u=(i(32),function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(e){var a;return Object(d.a)(this,i),(a=t.call(this,e)).ref=Object(n.createRef)(),a.width=0,a.height=0,a.cx=a.props.layout.cx,a.cy=a.props.layout.cy,a}return Object(o.a)(i,[{key:"componentDidMount",value:function(){var e=this.ref.current,t=0;for(var i in this.props.cards){var a=this.props.cards[i];this.drawImage(e,a.img,t++)}}},{key:"drawImage",value:function(e,t,i){var a=e.getContext("2d"),n=300*(this.props.layout.margin||0);this.width&&this.height||(e.width=this.width=t.width*this.cx+n*(this.cx-1),e.height=this.height=t.height*this.cy+n*(this.cy-1));var s=i%this.cx,c=Math.floor(i/this.cx),r=s*t.width+n*s,d=c*t.height+n*c;a.drawImage(t,r,d,t.width,t.height)}},{key:"render",value:function(){return Object(a.jsxs)("div",{className:"col-lg-4 col-md-6 mb-3 text-center",children:[Object(a.jsx)("canvas",{ref:this.ref,width:this.width,height:this.height}),this.props.cards.length," cards"]})}}]),i}(s.a.Component)),j=function(){function e(t,i){Object(d.a)(this,e),this.context=t,this.file=i,this.uuid=null}return Object(o.a)(e,[{key:"onLoad",value:function(e){this.uuid=this.context.addWaiting();var t=new Image;t.title=this.file.name,t.onload=this.imageOnLoad.bind(this),t.src=e.target.result}},{key:"imageOnLoad",value:function(e){this.context.addCard(e.target,e.target.title,this.uuid),this.context.removeWaiting(this.uuid)}}]),e}();function p(e,t){var i=new j(e,t);return i.onLoad.bind(i)}var m=i(11),x=function(){function e(t,i){Object(d.a)(this,e),this.context=t,this.file=i,m.a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(m.a.version,"/pdf.worker.js")}return Object(o.a)(e,[{key:"onLoad",value:function(e){m.a.getDocument(new Uint8Array(e.target.result)).promise.then(this.getDocument.bind(this),this.getDocumentFailed.bind(this))}},{key:"getDocument",value:function(e){var t=e.numPages;do{var i=this.context.addWaiting();e.getPage(t).then(this.getPage.bind(this,i),this.getPageFailed.bind(this,i))}while(t-- >1)}},{key:"getPage",value:function(e,t){var i=t.getViewport({scale:300/72}),a=document.createElement("canvas");document.body.appendChild(a),a.setAttribute("style","display: none;");var n=a.getContext("2d");a.width=i.width,a.height=i.height,t.render({canvasContext:n,viewport:i}).promise.then(this.rendered.bind(this,a,e,t),this.renderedFailed.bind(e))}},{key:"rendered",value:function(e,t,i){var a=document.createElement("img");a.setAttribute("src",e.toDataURL("image/jpeg")),a.setAttribute("width",e.width),a.setAttribute("height",e.height),document.body.removeChild(e),this.context.addCard(a,this.file.name+" page "+i.pageNumber,t),this.context.removeWaiting(t)}},{key:"getDocumentFailed",value:function(e){console.log("pdfjs.getDocument failed",e)}},{key:"getPageFailed",value:function(e,t){this.context.removeWaiting(e),console.log("pdfjs.document.getPage failed",t)}},{key:"renderedFailed",value:function(e,t){this.context.removeWaiting(e),console.log("pdfjs.document.page.render failed",t)}}]),e}();function g(e,t){var i=new x(e,t);return i.onLoad.bind(i)}var b=function(e){Object(l.a)(i,e);var t=Object(h.a)(i);function i(){var e;return Object(d.a)(this,i),(e=t.call(this)).layouts={tts:{cx:10,cy:7},pnp_poker:{cx:3,cy:3}},e.state={loading:!1,imposable:!1,cards:[],cardsCount:0,layout:"pnp_poker"},e.waiting=[],e}return Object(o.a)(i,[{key:"load",value:function(e){for(var t=e.target,i=t.files.length;i>0;){var a=t.files[i-1],n=new FileReader;switch(a.type){case"image/jpeg":case"image/png":n.onload=p(this,a),n.readAsDataURL(a);break;case"application/pdf":n.onload=g(this,a),n.readAsArrayBuffer(a);break;default:alert("no loader for "+a.type)}i--}t.value=""}},{key:"addCard",value:function(e,t,i){var a=this.state.cards,n={uuid:i,img:e,name:t,count:1};return a.push(n),this.setState({cards:a}),n}},{key:"updateLayout",value:function(e){e.persist(),this.setState({layout:e.target.value})}},{key:"updateCard",value:function(e,t,i){var a=this.state.cards;for(var n in a)a[n].uuid===e&&(a[n][t]=i);this.setState({cards:a,cardsCount:a.length})}},{key:"updateCardCount",value:function(e){e.persist(),this.updateCard(e.target.name,"count",e.target.value)}},{key:"render",value:function(){return Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("div",{className:"container-fluid",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsxs)("div",{className:"col-3",id:"sidebar",children:[Object(a.jsx)("h1",{children:"Deck-Imposer"}),Object(a.jsxs)("div",{className:"step mb-5",children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 1."})," Select Images or PDF"]}),Object(a.jsx)("div",{className:"form-group",children:Object(a.jsxs)("label",{className:"btn btn-primary",children:["Choose File(s)",Object(a.jsx)("input",{type:"file",name:"img[]",id:"upload",multiple:!0,onChange:this.load.bind(this),accept:"image/*,application/pdf",style:{display:"none"}})]})}),!0===this.state.loading&&Object(a.jsx)("p",{className:"alert alert-success text-center",children:"Processing..."})]}),Object(a.jsxs)("div",{className:"step mb-5",children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 2."})," Select Layout"]}),Object(a.jsx)("div",{className:"form-group",children:Object(a.jsxs)("select",{className:"form-control",onChange:this.updateLayout.bind(this),children:[Object(a.jsx)("option",{value:"pnp_poker",children:'PnP - Poker Size - "Letter" (3x3)'}),Object(a.jsx)("option",{value:"tts",children:"Tabletop Simulator Deck (10x7)"})]})})]}),Object(a.jsxs)("div",{className:"step mb-5",children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 3."})," Set quantity of each card."]}),Object(a.jsx)("div",{id:"cards",children:this.renderCards()})]}),Object(a.jsx)("div",{className:"step mb-5",children:Object(a.jsxs)("p",{children:[Object(a.jsx)("b",{children:"Step 4."})," Right click and save imposed image(s)."]})})]}),Object(a.jsxs)("div",{className:"col-9",id:"main",children:[Object(a.jsx)("div",{id:"top"}),Object(a.jsx)("div",{id:"canvas_container",children:this.renderSheets()})]})]})}),Object(a.jsx)("footer",{className:"container my-5",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsxs)("div",{className:"col-md-4",children:["For info or help, visit the ",Object(a.jsx)("a",{href:"https://github.com/BrianWendt/deck-imposer",children:"GitHub"})]}),Object(a.jsx)("div",{className:"col-md-4 text-center",children:"GNU General Public License v3.0"}),Object(a.jsx)("div",{className:"col-md-4 text-right",children:"Pay it forward."})]})})]})}},{key:"renderCards",value:function(){var e=this,t=this.state.cards.map((function(t){return Object(a.jsx)("div",{className:"form-group",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsx)("div",{className:"col-sm-9",children:Object(a.jsx)("label",{children:t.name})}),Object(a.jsx)("div",{className:"col-sm-3",children:Object(a.jsx)("input",{name:t.uuid,value:t.count,onChange:e.updateCardCount.bind(e),type:"number",min:"0",step:"1",className:"form-control"})})]})},t.uuid)}));return Object(a.jsx)("div",{children:t})}},{key:"renderSheets",value:function(){var e=[];if(this.state.loading)return Object(a.jsx)("div",{});var t=this.layouts[this.state.layout],i=[],n=0;for(var s in this.state.cards)for(var c=this.state.cards[s],r=c.count;r>0;)i.push(c),r--,++n===t.cx*t.cy&&(n=0,e.push(Object(a.jsx)(u,{cards:i,layout:t},Math.random())),i=[]);return e.push(Object(a.jsx)(u,{cards:i,layout:t},Math.random())),Object(a.jsx)("div",{className:"row",children:e})}},{key:"UUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:3&i|8).toString(16)}))}},{key:"addWaiting",value:function(){this.setState({loading:!0});var e=this.UUID();return this.waiting.push(e),e}},{key:"removeWaiting",value:function(e){var t=this.waiting.indexOf(e);t>-1&&this.waiting.splice(t,1),this.waiting.length<1&&this.setState({loading:!1})}}]),i}(s.a.Component),v=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,63)).then((function(t){var i=t.getCLS,a=t.getFID,n=t.getFCP,s=t.getLCP,c=t.getTTFB;i(e),a(e),n(e),s(e),c(e)}))};r.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(b,{})}),document.getElementById("root")),v()}},[[62,1,2]]]);
//# sourceMappingURL=main.91f3c24c.chunk.js.map